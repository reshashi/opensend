# MailForge Environment Configuration
# Copy this file to .env and fill in your values

# =============================================================================
# REQUIRED CONFIGURATION
# =============================================================================

# Database connection (PostgreSQL)
# For Docker: postgres://opensend:${POSTGRES_PASSWORD}@postgres:5432/opensend
# For local: postgresql://opensend:password@localhost:5432/opensend
DATABASE_URL=postgresql://opensend:password@localhost:5432/opensend

# API authentication secret (generate with: openssl rand -hex 32)
API_SECRET=your-secret-key-here

# Primary sending domain
PRIMARY_DOMAIN=mail.yourdomain.com

# =============================================================================
# DOCKER CONFIGURATION
# =============================================================================

# PostgreSQL settings (used by Docker Compose)
POSTGRES_USER=opensend
POSTGRES_PASSWORD=opensend
POSTGRES_DB=opensend

# MCP Server API Key (for AI agent integration)
MCP_API_KEY=mf_dev_test_key

# =============================================================================
# API SERVER
# =============================================================================

# API server port
API_PORT=3000

# API server host (0.0.0.0 for Docker, 127.0.0.1 for local dev)
API_HOST=0.0.0.0

# Node environment
NODE_ENV=development

# =============================================================================
# MCP SERVER
# =============================================================================

# MCP server port
MCP_PORT=3001

# MCP server host
MCP_HOST=0.0.0.0

# =============================================================================
# SMTP SERVER (HARAKA)
# =============================================================================

# SMTP port (25 for production, 2525 for development)
SMTP_PORT=25

# SMTP submission port (587 for STARTTLS)
SMTP_SUBMISSION_PORT=587

# SMTP hostname (used in HELO/EHLO and TLS certificate)
SMTP_HOSTNAME=mail.yourdomain.com

# Maximum message size in bytes (default: 25MB)
SMTP_MAX_SIZE=26214400

# =============================================================================
# WORKER CONFIGURATION
# =============================================================================

# Number of concurrent email processing workers
WORKER_CONCURRENCY=10

# Maximum retry attempts for failed emails
MAX_RETRIES=3

# Delay between retries in milliseconds
RETRY_DELAY_MS=5000

# Polling interval for new messages in milliseconds
POLL_INTERVAL_MS=5000

# =============================================================================
# REDIS (OPTIONAL - for job queue and caching)
# =============================================================================

# Redis URL (leave empty to use in-memory queue)
# For Docker: redis://redis:6379
# For local: redis://localhost:6379
REDIS_URL=redis://localhost:6379

# =============================================================================
# RATE LIMITING
# =============================================================================

# Maximum emails per minute per API key
RATE_LIMIT_PER_MINUTE=100

# Maximum emails per hour per API key
RATE_LIMIT_PER_HOUR=1000

# Maximum emails per day per API key
RATE_LIMIT_PER_DAY=10000

# =============================================================================
# WEBHOOKS
# =============================================================================

# Webhook signing secret (generate with: openssl rand -hex 32)
WEBHOOK_SECRET=your-webhook-secret-here

# Webhook retry attempts
WEBHOOK_MAX_RETRIES=5

# Webhook timeout in milliseconds
WEBHOOK_TIMEOUT=30000

# =============================================================================
# DKIM SIGNING
# =============================================================================

# DKIM selector (e.g., 'opensend' or 'default')
# This forms part of the DNS record: selector._domainkey.domain.com
DKIM_SELECTOR=opensend

# DKIM private key path (relative to project root)
# For Docker, keys are mounted at /app/keys/
DKIM_PRIVATE_KEY_PATH=./keys/dkim-private.pem

# =============================================================================
# LOGGING
# =============================================================================

# Log level (debug, info, warn, error)
LOG_LEVEL=info

# Log format (json, pretty)
LOG_FORMAT=json

# =============================================================================
# TLS/SSL CERTIFICATES
# =============================================================================

# TLS certificate paths (for Haraka SMTP)
# If not provided, self-signed certificates will be generated
# TLS_CERT_PATH=./keys/tls-cert.pem
# TLS_KEY_PATH=./keys/tls-key.pem

# =============================================================================
# MONITORING (OPTIONAL)
# =============================================================================

# Sentry DSN for error tracking
# SENTRY_DSN=https://xxx@sentry.io/xxx

# Prometheus metrics port (set to enable)
# METRICS_PORT=9090

# =============================================================================
# HOSTED SERVICE ONLY (not needed for self-hosting)
# =============================================================================

# Stripe API key for billing
# STRIPE_SECRET_KEY=sk_live_xxx

# Stripe webhook secret
# STRIPE_WEBHOOK_SECRET=whsec_xxx

# =============================================================================
# DEVELOPMENT ONLY
# =============================================================================

# Enable debug mode (verbose logging, stack traces)
# DEBUG=true

# Skip DNS verification for local development
# SKIP_DNS_VERIFICATION=true

# Use test mode (emails logged but not sent)
# TEST_MODE=true
