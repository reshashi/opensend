; =============================================================================
; MailForge Haraka Access Control Configuration
; =============================================================================
;
; This file controls which connections are allowed to send mail through
; the Haraka SMTP server.
;
; See: https://haraka.github.io/manual/plugins/access.html
;

[check]
; Enable various access checks
any=true
conn=true
helo=true
mail=true
rcpt=true

[conn]
; Connection-level access control

; Allow all connections from localhost (Docker internal)
; These are typically from the MailForge worker
white_list=127.0.0.0/8,::1,172.16.0.0/12,10.0.0.0/8,192.168.0.0/16

; Block known bad actors (add IPs/networks as needed)
; black_list=

[helo]
; HELO/EHLO access control

; Reject connections that don't provide a HELO
require=true

; Check that HELO matches PTR record (can cause legitimate mail to be rejected)
check_ptr=false

[mail]
; MAIL FROM access control

; Allow any sender from whitelisted IPs
white_list=127.0.0.0/8,::1,172.16.0.0/12,10.0.0.0/8,192.168.0.0/16

; Block specific sender addresses or domains
; black_list_sender=spam@example.com,@baddomain.com

[rcpt]
; RCPT TO access control

; Relay control - who can relay mail through this server
; For MailForge, we want to allow relaying from internal services only

; Allow relay from internal networks (Docker, localhost)
relay_white_list=127.0.0.0/8,::1,172.16.0.0/12,10.0.0.0/8,192.168.0.0/16

; Block relay to specific domains
; black_list_rcpt=@blacklisted.com

[whitelist]
; IP addresses that bypass all access checks
; Use sparingly - these IPs can do anything

; Docker internal networks
127.0.0.1
::1
; Docker bridge network (default range)
172.17.0.0/16
172.18.0.0/16
172.19.0.0/16
172.20.0.0/16

[blacklist]
; IP addresses that are always blocked
; Add known bad actors here

[rate_limit]
; Connection rate limiting

; Enable rate limiting
enabled=false

; Maximum connections per IP per minute
max_connections=60

; Maximum messages per connection
max_messages=100

; Maximum recipients per message
max_recipients=100
