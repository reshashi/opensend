; =============================================================================
; MailForge Haraka SMTP Forward Configuration
; =============================================================================
;
; This file configures the queue/smtp_forward plugin for outbound
; mail delivery.
;
; See: https://haraka.github.io/manual/plugins/queue/smtp_forward.html
;

[main]
; Forward all messages to the recipient's MX
enable_outbound=true

; Queue directory for pending messages
queue_dir=/app/queue

; Maximum concurrent outbound connections
max_connections=100

[outbound]
; Outbound delivery configuration

; Number of concurrent connections per recipient domain
concurrency_max=10

; Enable TLS for outbound connections
enable_tls=true

; Require TLS (will fail delivery to servers without TLS)
require_tls=false

; Verify remote TLS certificates
verify_certificates=false

; Fallback to plain text if TLS fails
tls_fallback=true

[retry]
; Retry configuration for failed deliveries

; Maximum number of retries
max_retries=8

; Retry schedule (comma-separated delays in seconds)
; Retries at: 1min, 5min, 15min, 30min, 1hr, 2hr, 4hr, 8hr
schedule=60,300,900,1800,3600,7200,14400,28800

; Maximum time to keep message in queue (seconds)
; Default: 5 days
max_age=432000

[bounce]
; Bounce handling

; Generate bounce messages for permanent failures
generate_bounces=true

; Bounce message sender
bounce_from=mailer-daemon@${HARAKA_HOSTNAME}

; Send bounces to postmaster if original sender is invalid
postmaster_fallback=true

[headers]
; Header modifications for outbound messages

; Add Received header
add_received=true

; Add Date header if missing
add_date=true

; Add Message-ID if missing
add_message_id=true

[connection]
; Connection settings

; Connection timeout (seconds)
connect_timeout=30

; Command timeout (seconds)
command_timeout=300

; Total transaction timeout (seconds)
total_timeout=600

; Pool idle timeout (seconds)
pool_timeout=60

[limits]
; Message limits

; Maximum message size (bytes)
; Set to 0 for no limit (uses Haraka default)
max_size=0

; Maximum line length
max_line_length=16384

; Maximum recipients per message
max_recipients=1000

[ipv6]
; IPv6 configuration

; Prefer IPv6 for outbound connections
prefer_ipv6=false

; Use IPv6 if available
enable_ipv6=true

[mta_sts]
; MTA-STS support (SMTP security)

; Enable MTA-STS checking
enabled=false

; Cache MTA-STS policies
cache_policies=true

; Policy cache TTL (seconds)
cache_ttl=86400
